# 参考资料

1. [刨根究底字符编码之零——前言 - 笨笨阿林 - 博客园 (cnblogs.com)](https://www.cnblogs.com/benbenalin/p/6881980.html)
2. [Charset (Java SE 17 & JDK 17) (oracle.com)](https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/nio/charset/Charset.html)
3. [Character Sets (iana.org)](http://www.iana.org/assignments/character-sets/character-sets.xhtml)
4. [UTR#17: Unicode Character Encoding Model](http://www.unicode.org/reports/tr17/)
5. [GBK 编码范围, GBK 编码表 (qqxiuzi.cn)](https://www.qqxiuzi.cn/zh/hanzi-gbk-bianma.php)
6. [URI (Java SE 17 & JDK 17) (oracle.com)](https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/net/URI.html)
7. [RFC 2396标准_hotmee的博客-CSDN博客](https://blog.csdn.net/hotmee/article/details/107298462)

# 术语

## 抽象字符

抽象字符，是指我们日常可见的字符。

简体汉字、繁体汉字、拉丁字符、罗马数字、阿拉伯数字、古印度文字、楔形文字、甲骨文等等，都属于抽象字符。

在没有计算机之前，这些字符仍然广泛使用。

随着时代的发展，目前互联网常见的各类表情符号，也属于抽象字符。

## 抽象字符编号

计算机使用电路开关来处理 0、1 数字，为了使计算机可以表示抽象字符，人们开始对常见的字符进行编号。编号为非负整数，使其可以被二进制表示。

最早推广使用的编号为 ASCII 码：使用 8 位二进制（0x00 - 0xFF）表示至多 256 个字符。

随着计算机的推广，在历史上出现了非常多的编号方式，欧洲、东南亚各国纷纷基于本国字符建立了不同的编号方式，例如中国曾经推出了如 GB2312、GBK、GB18030 等国标字符。

编号转换不便，统一成为了必然。

由此，出现了可以囊括全球所有抽象字符的 unicode 码：使用 0x000000 - 0x10FFFF 编号，可以表示至多 17*65536 个字符。

## 字符集

抽象字符，及其抽象字符编号，统称为字符集，也可以称为抽象字符集。

可以理解为抽象字符与抽象字符编号的映射。

例如：ASCII 字符集、ISO-8859-1 字符集（latin1）、GB2312 字符集、GBK 字符集、GB18030 字符集、Unicode 字符集等。

* ASCII 字符集：基本 ASCII 字符集使用 7 bit 表示一个字符，共 128 个字符。扩展的 ASCII 字符集使用 8 bit 表示一个字符，共 256 个字符。前 128 位主要为英文中的可打印字符，后 128 位主要为计算机控制字符。
* ISO-8859-1 字符集（latin1）：和 ASCII 码同样使用 8 bit 表示一个字符，共 256 个字符。前128个字符兼容 ASCII 字符集；后 128 个字符包含了一些被西欧国家使用的字符以及一些常用的特殊字符。
* GB2312 字符集：国标，简体中文字符集，包含 7000 多个中文。小于 127 的 8 bit 字符兼容 ASCII 字符集；2 个大于 127 的 8 bit 表示一个中文字符。
* GBK：国标，最常用的中文字符集，包含 21003 个中文、繁体中文以及日韩文字等。完全兼容 GB2312 字符集，对其进行了扩展：GBK 字符集使用 16 进制表示，首字节在 81-FE 之间，尾字节在 40-FE 之间，剔除 xx7F 一线。
* GB18030：国标，最新的中文字符集，包含 70244 个中文、繁体中文、少数民族文字、生僻字以及日韩文字等。长度为 1 个、2 个或 4 个字节。几乎兼容 GBK 字符集。
* Unicode 字符集：统一码、标准万国码，世界范围内通用的字符集，由专门的机构维护，目前仍在持续更新中。其使用 4 个字节的长度表示一个字符。可以使用 UTF-8、UTF-16、UTF-32 三种编码方式对其进行适当的编码优化。

## 字形码

抽象字符在屏幕显示或打印机打印时，需要根据字体映射为字符点阵，也称字形码。

可以使用 16×16、24×24、48×48 的字符点阵表示出抽象字符。我们以 16×16 的点阵示意，使用 excel 模拟字符点阵：

![image-20211020163951054](D:/Codes/study-notes/计算机字符集.assets/image-20211020163951054.png)

## 字符编码

将抽象字符编号，按照一定的编码方式，转换为计算机二进制的过程，叫做字符编码。

抽象字符编号可以是字符编码，例如 ASCII 编码；

也可以是经过一定规则转换后的编码，例如 utf-8 编码、utf-16 编码。

## 编码字符集

抽象字符经过编码后，形成的字符和编码的集合，也被称为编码字符集。

## 字符解码

将计算机二进制字节，按照一定的解码方式，转换为抽象字符编号的过程，叫做字符解码。



# 字符集取值范围

## ASCII

0x00 - 0xFF

## GB 2312



## GBK

0x8140 - 0xFEFE 剔除 xx7F 一线

首字节在 81-FE 之间，尾字节在 40-FE 之间，剔除 xx7F 一条线

## Unicode

0x00 0000 - 0x10 FFFF

# 案例一：int 类型强转为 char 类型

## 环境

windows javaSE 64位 16.0.1

## int 类型取值

```java
从javaSE源码可得知：
// java.lang.Integer
@Native public static final int   MIN_VALUE = 0x80000000;
@Native public static final int   MAX_VALUE = 0x7fffffff;
/* 以二进制字符串表示，即为：
 * 1000 0000|0000 0000|0000 0000|0000 0000 
 * 至
 * 0111 1111|1111 1111|1111 1111|1111 1111
 * int类型是有符号数
 */
```

## char 类型取值

```java
// java.lang.Character
public static final char MIN_VALUE = '\u0000';
public static final char MAX_VALUE = '\uFFFF';
/* 以二进制字符串表示，即为：
 * 0000 0000|0000 0000 
 * 至
 * 1111 1111|1111 1111
 * char类型无符号，使用unicode字符集
 */
```

## 强转规则

推测：

```java
int i;
char ch = (char)i;
```

由于 int 类型为 32 位，而 char 类型为 16 位，因此，强转时，char 类型赋值为 int 类型的低位 16 位。

char 类型使用 unicode 字符集，因此按照 unicode 码点（Code Point）转换为 unicode 字符。

注意：并非 utf-16 编码，而是 16 位的 unicode 字符。

## 测试验证

```java
/* 字符'0'，unicode字符编号48，char类型二进制字符串编码 0000 0000|0011 0000
 * 因此，以下格式的 int 类型数据，均可以强制转换为字符'0'：
 * **** ****|**** ****|0000 0000|0011 0000
 * 例如：
 * 48     -> 0000 0000|0000 0000|0000 0000|0011 0000
 * 65584  -> 0000 0000|0000 0001|0000 0000|0011 0000
 * 131120 -> 0000 0000|0000 0010|0000 0000|0011 0000
 * -65488 -> 1111 1111|1111 1111|0000 0000|0011 0000
 */
for (int i = 48; i < 58; i++) {
    System.out.print(i + ": " + (char) i + " | ");
}
System.out.println("\n**************");

for (int i = 65584; i < 65594; i++) {
    System.out.print(i + ": " + (char) i + " | ");
}
System.out.println("\n**************");

for (int i = -65488; i < -65478; i++) {
    System.out.print(i + ": " + (char) i + " | ");
}
/* 输出结果符合预期：
48: 0 | 49: 1 | 50: 2 | 51: 3 | 52: 4 | 53: 5 | 54: 6 | 55: 7 | 56: 8 | 57: 9 | 
**************
65584: 0 | 65585: 1 | 65586: 2 | 65587: 3 | 65588: 4 | 65589: 5 | 65590: 6 | 65591: 7 | 65592: 8 | 65593: 9 | 
**************
-65488: 0 | -65487: 1 | -65486: 2 | -65485: 3 | -65484: 4 | -65483: 5 | -65482: 6 | -65481: 7 | -65480: 8 | -65479: 9 | 
 */
```

# 案例二：byte 数组生成字符串

```java
public String(byte bytes[], Charset charset){
    //...
}
```

只要确定了编码字符集，便可以对字节数组进行解码。反之，如果不确定编码字符集，则无法对字节数组进行解码，仅可以猜测字符集。

只有字节流是真实存在于计算机系统内的。

# 案例三：序列化与反序列化







# GB 18030 和 Unicode 标准的关系

## GB 18030 简介

GB 18030 是指符合中国国家标准的字符集，最新的标准文号为 GB 18030-2022

GB 18030-2022 的参考文件包括：

* GB/T 2312-1980 信息交换用汉字编码字符集 基本集
* GB/T 11383-1989 信息处理 信息交换用八位代码结构和编码规则，标准等同采用 ISO 国际标准：ISO 4873:1986 Information processing — ISO 8-bit code for information interchange — Structure and rules for implementation
* GB/T 13000 信息技术 通用多八位编码字符集（UCS），标准等同采用 ISO/IEC 国际标准：ISO/IEC 10646:2003 Information technology — Universal coded character set (UCS)

其中，GB/T 2312-1080 为国内标准，GB/T 11383 和 GB/T 13000 均直接采用国际标准。

[Online Browsing Platform (OBP) (iso.org)](https://www.iso.org/obp/ui/#home)

[Publicly Available Standards (iso.org)](https://standards.iso.org/ittf/PubliclyAvailableStandards/index.html)

[Unicode 14.0 Character Code Charts](https://www.unicode.org/charts/)

## GB/T 2312 简介

GB 2312 字符集，定义了信息交换使用的中文基本图形字符及其二进制编码展示。

GB/T 2312-1980 的参考文件包括：

* GB 1988-80 信息处理交换用的七位编码字符集，当前版本为 GB/T 1988-1998 信息技术 信息交换用七位编码字符集，标准等效采用 ISO/IEC 国际标准：ISO/IEC 646:1991 Information technology — 7-bit coded character set for information interchange
* GB 2311-80 信息处理交换用七位编码字符集的扩充方法，当前版本为 GB/T 2311-2000 信息技术 字符代码结构与扩充技术，标准等同采用 ISO/IEC 国际标准：ISO/IEC 2022:1994 Information technology — Character code structure and extension techniques

### GB/T 1988 简介

当前可以查阅到的版本为 ISO/IEC 646:1991，根据 ISO 网站上可以找到的介绍：

> This International Standard specifies a set of 128 characters, (control characters and graphic characters such as letters, digits and symbols) with their coded representation. Most of these characters are mandatory and unchangeable, but provision is made for some flexibility to accommodate national and other requirements.
>
> This International Standard specifies a 7-bit coded character set with a number of options. It also provides guidance on how to exercise the options to define specific national versions and application-oriented versions. Furthermore it specifies the International Reference Version (IRV) in which such options have been exercised.

可以看到，这个标准使用 7 个字节编码表示字符，共定义了 128 个字符，包括控制符、字母、数字、图标等，从 0x00-0x7F。

### GB/T 2311简介

当前可以查阅到的版本为 ISO/IEC 2022:1994，根据 ISO 网站上可以找到的介绍：

> This International Standard specifies the structure of 8-bit codes and 7-bit codes which provide for the coding of character sets. The code elements used in the structure are common to both the 8-bit and 7-bit codes. The codes use a variety of techniques for extending the capabilities of elementary 8-bit and 7-bit codes. Greater emphasis is given to 8-bit codes in this edition of the Standard than in previous editions because they are now more widely used.

可以看到，这个标准使用 8 个字节编码表示字符，但其定义了扩展字符的方式，支持使用多个 8 字节编码来表示更多的字符。



### GB/T 2312 字符范围简介

GB/T 2312 使用双字节（7 位代表一字节）表示字符，标准共收录字符 7455 个。收录内容如下：

1. 一般符号 202 个。包括间隔、标点符号、运算符号、单位符号以及制表符等。
2. 序号 60 个。其中 `1.` ~ `20.` 共 20 个；`⑴` ~ `⒇` 共 20 个；`①` ~ `⑩` 共 10 个；`㈠` ~ `㈩` 共 10 个。
3. 数字 22 个。其中 `0` ~ `9` 共 10 个；`Ⅰ` ~ `Ⅻ` 共 12 个。
4. 拉丁字母 52 个。其中大写字母 `A` ~ `Z` 共 26 个；`a` ~ `z` 共 26 个。
5. 日文假名 186 个。其中平假名（包括浊音、半浊音及拗音、促音等小写假名）86 个；片假名（包括浊音、半浊音及拗音、促音等小写假名） 86 个。
6. 希腊字母 48 个。其中大写字母 `Α` ~ `Ω` 共 24 个；小写字母 `α` ~ `ω` 共 24 个。
7. 俄文字母 66 个。其中大写字母 `А` ~ `Я` 共 33 个；小写字母 `а` ~ `я` 共 33 个。
8. 汉语拼音符号 26 个。包括带声调的符号和其他符号的字母。
9. 汉语注音字母 37 个。
10. 汉字 6763 个。其中第一级汉字 3755 个，第二级汉字 3008 个。



根据分析，该标准与 Unicode 标准的映射关系较为混乱，有连续的，也有非连续的，需要逐一处理来建立映射关系。



其附录包括：

1. 一般符号名称
2. 汉字的分级与排列

同时，附件内还定义了部首索引、汉语拼音索引、简化字与繁体字及异形体对照表



## GB/T 11383 简介

当前可以查阅到的版本为 ISO/IEC 4873:1991，根据 ISO 网站上可以找到的介绍：

> This International Standard specifies an 8-bit code with a number of options. It also provides guidance on how to exercise the options to define specific versions.
>
> This code is primarily intended for general information interchange within an 8-bit environment among data processing systems and associated equipment, and within data communication systems. The need for graphic characters and control functions in data processing has also been taken into account.
>
> The code includes the 10 digits as well as the 52 small and capital letters of the basic Latin alphabet and may include accented letters, special Latin letters and/or the letters of one or several non-Latin alphabet(s).

可以看到，这个标准定义了数字、大小写字母、以及一些拉丁字符和控制字符。

## GB/T 13000 简介

当前可以查阅到的版本为 ISO/IEC 10646:2020，根据 ISO 网站上可以找到的介绍：

> This document specifies the Universal Coded Character Set (UCS). It is applicable to the representation, transmission, interchange, processing, storage, input and presentation of the written form of the languages of the world as well as additional symbols.
>
> This document
>
> - — specifies the architecture of the UCS;
> - — defines terms used for the UCS;
> - — describes the general structure of the UCS codespace;
> - — specifies the assigned planes of the UCS: the Basic Multilingual Plane (BMP) of the UCS, the Supplementary Multilingual Plane SMP), the Supplementary Ideographic Plane (SIP), the Tertiary Ideographic Plane (TIP), and the Supplementary Special-purpose Plane (SSP);
> - — defines a set of graphic characters used in scripts and the written form of languages on a world-wide scale;
> - — specifies the names for the graphic characters and format characters of the BMP, SMP, SIP, TIP, SSP and their coded representations within the UCS codespace;
> - — specifies the coded representations for control characters and private use characters;
> - — specifies three encoding forms of the UCS: UTF-8, UTF-16, and UTF-32;
> - — specifies seven encoding schemes of the UCS: UTF-8, UTF-16, UTF-16BE, UTF-16LE, UTF-32, UTF-32BE, and UTF-32LE;
> - — specifies the management of future additions to this coded character set.

可以看到，这个标准定义了 UCS/ Unicode 码，以及其编码方式。

## 转换关系

GB 18030 完全延续了 GB/T 2312 在双字节上对字符的处理，是对 GB/T 2312 的补充。但同时，参考 Unicode 标准中可能使用的字符对其进行了扩充，包括单字节字符、双字节字符、四字节字符。

因此，在双字节标准上，GB 18030 延续了 GB/T 2312 对 Unicode 的混乱映射。但在单字节和四字节标准上，GB 18030 对 Unicode 的映射较为连续，处理相对方便。

![image-20220804161625114](D:\Codes\study-notes\计算机字符集.assets\image-20220804161625114.png)

![image-20220804161654868](D:\Codes\study-notes\计算机字符集.assets\image-20220804161654868.png)

![image-20220804162015392](D:\Codes\study-notes\计算机字符集.assets\image-20220804162015392.png)

![image-20220804162035166](D:\Codes\study-notes\计算机字符集.assets\image-20220804162035166.png)



详细的转换算法，可以参考《GB+18030与Unicode编码转换算法》

